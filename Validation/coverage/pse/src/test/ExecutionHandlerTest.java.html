<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>ExecutionHandlerTest.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Coverage (04.03.2012 23:49:19)</a> &gt; <a href="../../index.html" class="el_group">pse</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.html" class="el_package">test</a> &gt; <span class="el_source">ExecutionHandlerTest.java</span></div><h1>ExecutionHandlerTest.java</h1><pre class="source lang-java linenums">package test;

import interpreter.GlobalBreakpoint;
import interpreter.StatementBreakpoint;
import misc.ExecutionHandler;
import misc.MessageSystem;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;

import java.util.ArrayList;

import static org.junit.Assert.*;
/**
 *
 */
<span class="fc" id="L17">public class ExecutionHandlerTest {</span>
    private MessageSystem messageSystem;
    private ExecutionHandler executionHandler;
<span class="fc" id="L20">    private final ArrayList&lt;StatementBreakpoint&gt; stmtBps =</span>
<span class="fc" id="L21">            new ArrayList&lt;StatementBreakpoint&gt;();</span>
<span class="fc" id="L22">    private final ArrayList&lt;GlobalBreakpoint&gt; glblBps =</span>
<span class="fc" id="L23">            new ArrayList&lt;GlobalBreakpoint&gt;();</span>

    @Before
    public void setUp() {
<span class="fc" id="L27">        messageSystem = new MessageSystem();</span>
<span class="fc" id="L28">        executionHandler = new ExecutionHandler(messageSystem);</span>
<span class="fc" id="L29">    }</span>

    @After
    public void tearDown() {
<span class="fc" id="L33">        messageSystem = null;</span>
<span class="fc" id="L34">        executionHandler = null;</span>
<span class="fc" id="L35">    }</span>

    @Test
    public void testLoop() {
<span class="fc" id="L39">        executionHandler.parse(&quot;main() {int i; int limit=1000; while (i&lt;limit)&quot; +</span>
                &quot;invariant i&gt;= 0;{i=i+1;}ensure i&gt;= 0;}&quot; +
        		&quot;ensure i == limit;&quot;);
<span class="fc" id="L42">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L43">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L44">    }</span>

    @Test
    public void testArrayEqual() {
<span class="fc" id="L48">        executionHandler.parse(&quot;main() {bool[] x = array[3];&quot; +</span>
                &quot;bool[] y = array[3];} ensure x == y;&quot;);
<span class="fc" id="L50">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L51">        assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L52">    }</span>

    @Test
    public void testArrayNotEqualValues() {
<span class="fc" id="L56">        executionHandler.parse(&quot;main() {bool[] x = array[3];&quot; +</span>
                &quot;bool[] y = array[3]; y[2] = true;} ensure x != y;&quot;);
<span class="fc" id="L58">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L59">        assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L60">    }</span>

    @Test
    public void testArrayNotEqualLength() {
<span class="fc" id="L64">        executionHandler.parse(&quot;main() {bool[] x = array[3];&quot; +</span>
                &quot;bool[] y = array[4];} ensure x != y;&quot;);
<span class="fc" id="L66">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L67">        assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L68">    }</span>

    @Test
    public void testDivision() {
<span class="fc" id="L72">        executionHandler.parse(&quot;main() {assert 4/2==2; assert 5/3==1;&quot; +</span>
                &quot;assert (-4)/2==-2; assert (-5)/3==-2;&quot; +
                &quot;assert 4/(-2)==-2; assert 5/(-3)==-1;&quot; +
                &quot;assert (-4)/(-2)==2; assert (-5)/(-3)==2;}&quot;);
<span class="fc" id="L76">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L77">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L78">    }</span>

    @Test
    public void testModulo() {
<span class="fc" id="L82">        executionHandler.parse(&quot;main() {assert 4%2==0; assert 5%3==2;&quot; +</span>
                &quot;assert (-4)%2==0; assert (-5)%3==1;&quot; +
                &quot;assert 4%(-2)==0; assert 5%(-3)==2;&quot; +
                &quot;assert (-4)%(-2)==0; assert (-5)%(-3)==1;}&quot;);
<span class="fc" id="L86">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L87">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L88">    }</span>

    @Test
    public void testIf() {
<span class="fc" id="L92">        executionHandler.parse(&quot;main() {int i; if (i&lt;2)&quot; +</span>
                &quot;{int i = -1;}}&quot; +
                &quot;ensure i == 00000;&quot;);
<span class="fc" id="L95">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L96">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L97">    }</span>

    @Test
    public void testIfElse() {
<span class="fc" id="L101">        executionHandler.parse(&quot;main() {int i; if (i&gt;2) {int i = -1;}&quot; +</span>
                &quot;else {i=2;}}&quot; +
                &quot;ensure i == 000002;&quot;);
<span class="fc" id="L104">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L105">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L106">    }</span>

    @Test
    public void testParams() {
<span class="fc" id="L110">        executionHandler.parse(&quot;main(int i, int[][] r)&quot; +</span>
                &quot;{int j = 0; while (j &lt; length(r)){i=i+r[j][0]; j=j+1;}}&quot; +
                &quot;ensure i == 42;&quot;);
<span class="fc" id="L113">        executionHandler.setParameterValues(</span>
<span class="fc" id="L114">                new String[]{&quot;2&quot;, &quot;{{20},{11},{9}}&quot;});</span>
<span class="fc" id="L115">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L116">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L117">    }</span>

    @Test
    public void testArraySum() {
<span class="fc" id="L121">        executionHandler.parse(&quot;int sum(int[] i){int j = 0;int res = 0;&quot; +</span>
                &quot;while(j&lt;length(i)){res = res+i[j]; j=j+1;} return res;}&quot; +
                &quot;main() {int[] x = array[3]; x[0]=2;x[1]=-1;x[2]=2;&quot; +
                &quot;int h = sum(x);} ensure h == 3;&quot;);
<span class="fc" id="L125">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L126">        assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L127">    }</span>
    
    @Test
    public void testEmptyProgramEnsureTrue() {
<span class="fc" id="L131">        executionHandler.parse(&quot;main(){} ensure true;&quot;);</span>
<span class="fc" id="L132">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L133">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L134">	}</span>

    @Test
    public void testAssignmentAndEnsure() {
<span class="fc" id="L138">        executionHandler.parse(&quot;main() {int x = 1;} ensure x &gt; 0;&quot;);</span>
<span class="fc" id="L139">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L140">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L141">	}</span>

    @Test
    public void testQuantifiers() {
<span class="fc" id="L145">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4;}&quot; +
                &quot;ensure forall x(2,j) exists z(1,2) (j==x+z) | (j==x*z);&quot;);
<span class="fc" id="L148">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L149">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L150">    }</span>

    @Test
    public void testRecursion() {
<span class="fc" id="L154">        executionHandler.parse(&quot;int rek(int n, int k) assume {n &gt;= k; k &gt;= 0;} {&quot; +</span>
                    &quot;int result = 1;&quot; +
                    &quot;if ((n != k) &amp; (k != 0) &amp; (n != 0)) {&quot; +
                            &quot;result = rek(n-1, k-1)+rek(n-1, k);&quot; +
                    '}' +
                    &quot;return result;&quot; +
                    '}' +
                    &quot;main(){&quot; +
                            &quot;int n=4;int k=2;&quot; +
                            &quot;int f = rek(n,k);&quot; +
                    &quot;} ensure f==6;&quot;);
<span class="fc" id="L165">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L166">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L167">    }</span>

    @Test
    public void testArrays() {
<span class="fc" id="L171">        executionHandler.parse(&quot;main() {&quot; +</span>
                    &quot;int n = 5; int k = 3; int r = 10;&quot; +
                    &quot;int[][] table = array[n+1][k+1];&quot; +
                    &quot;int i=0; while (i&lt;=n) {&quot; +
                        &quot;int j=0; while ((j&lt;=i) &amp; (j &lt;= k)) {&quot; +
                            &quot;if ((i == j) | (i == 0) | (j == 0)) {&quot; +
                            &quot;table[i][j] = 1;} else {&quot; +
                            &quot;assert (i-1&gt;=0)&amp;(j-1&gt;=0)&amp;(j&lt;=k);&quot; +
                    &quot;table[i][j] = table[i-1][j-1]+table[i-1][j];}&quot; +
                            &quot;j=j+1;&quot; +
                        &quot;}i=i+1;&quot; +
                    &quot;}} ensure table[n][k] == r;&quot;);
<span class="fc" id="L183">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L184">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L185">    }</span>

    @Test
    public void testEmptyProgram() {
<span class="fc" id="L189">        executionHandler.parse(&quot;main(){}&quot;);</span>
<span class="fc" id="L190">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L191">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L192">	}</span>

    @Test
    public void testAssumptions() {
<span class="fc" id="L196">        executionHandler.parse(&quot;main(bool i) assume i; {}&quot;);</span>
<span class="fc" id="L197">        executionHandler.setParameterValues(</span>
<span class="fc" id="L198">                new String[]{&quot;true&quot;});</span>
<span class="fc" id="L199">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L200">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L201">    }</span>

    @Test
    public void testNegation() {
<span class="fc" id="L205">        executionHandler.parse(&quot;main(bool i) {}ensure !i;&quot;);</span>
<span class="fc" id="L206">        executionHandler.setParameterValues(</span>
<span class="fc" id="L207">                new String[]{&quot;false&quot;});</span>
<span class="fc" id="L208">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L209">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L210">    }</span>

    @Test
    public void testEmptyExists() {
<span class="fc" id="L214">        executionHandler.parse(&quot;main() {}ensure exists h() false;&quot;);</span>
<span class="fc" id="L215">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L216">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L217">    }</span>

    @Test
    public void testAssumptionsFail() {
<span class="fc" id="L221">        executionHandler.parse(&quot;main(bool i) assume i; {}&quot;);</span>
<span class="fc" id="L222">        executionHandler.setParameterValues(</span>
<span class="fc" id="L223">                new String[]{&quot;false&quot;});</span>
<span class="fc" id="L224">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L225">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L226">    }</span>

    @Test
    public void testQuantifierFail() {
<span class="fc" id="L230">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4;}&quot; +
                &quot;ensure forall x(2,j) exists z(1,2) (j==x*z);&quot;);
<span class="fc" id="L233">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L234">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L235">	}</span>

    @Test
    public void testDivZero() {
<span class="fc" id="L239">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4; j = j/(j-4);}&quot;);
<span class="fc" id="L241">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L242">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L243">	}</span>

    @Test
    public void testArrayLength() {
<span class="fc" id="L247">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int[][][] j = array[2][0][3];}&quot;);
<span class="fc" id="L249">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L250">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L251">	}</span>

    @Test
    public void testArrayIndexRead() {
<span class="fc" id="L255">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int[][][] j = array[2][1][3]; int i = j[2][0][1];}&quot;);
<span class="fc" id="L257">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L258">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L259">	}</span>

    @Test
    public void testArrayIndexAssign() {
<span class="fc" id="L263">        executionHandler.parse(&quot;main()&quot; +</span>
        		&quot;{int[][][] j = array[2][1][3]; j[1][-1][1] = 2;}&quot;);
<span class="fc" id="L265">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L266">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L267">	}</span>

    @Test
    public void testModuloZero() {
<span class="fc" id="L271">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 2%0;}&quot;);
<span class="fc" id="L273">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L274">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L275">	}</span>

    @Test
    public void testExistsFail() {
<span class="fc" id="L279">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4;}&quot; +
                &quot;ensure exists z(1,2) (j==3*z);&quot;);
<span class="fc" id="L282">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L283">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L284">	}</span>

    @Test
    public void testForAllFail() {
<span class="fc" id="L288">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4;}&quot; +
                &quot;ensure forall x() (j==x*2);&quot;);
<span class="fc" id="L291">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L292">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L293">	}</span>

    @Test
    public void testEmptySetExistsFail() {
<span class="fc" id="L297">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4;}&quot; +
                &quot;ensure exists z(j,2) true;&quot;);
<span class="fc" id="L300">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L301">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L302">	}</span>

    @Test
    public void testInvariantFailMiddle() {
<span class="fc" id="L306">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4; while (j &lt; 20) invariant j != 15; {j=j+1;}}&quot;);
<span class="fc" id="L308">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L309">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L310">	}</span>

    @Test
    public void testInvariantFailBeginning() {
<span class="fc" id="L314">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4; while (j &lt; 20) invariant j &gt; 4; {j=j+1;}}&quot;);
<span class="fc" id="L316">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L317">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L318">	}</span>

    @Test
    public void testInvariantFailEnd() {
<span class="fc" id="L322">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4; while (j &lt; 20) invariant j &lt; 20; {j=j+1;}}&quot;);
<span class="fc" id="L324">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L325">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L326">	}</span>

    @Test
    public void testEmptyProgramEnsureFalse() {
<span class="fc" id="L330">        executionHandler.parse(&quot;main(){} ensure false;&quot;);</span>
<span class="fc" id="L331">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L332">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L333">	}</span>

    @Test
    public void testAssumeFalse() {
<span class="fc" id="L337">        executionHandler.parse(&quot;main() assume false;{}&quot;);</span>
<span class="fc" id="L338">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L339">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L340">	}</span>

    @Test
    public void testRecursionFail() {
<span class="fc" id="L344">        executionHandler.parse(&quot;int rek(int n, int k) assume {n &gt;= k; k &gt;= 0;} {&quot; +</span>
                    &quot;int result = 1;&quot; +
                    &quot;if ((n != k) &amp; (k != 0) &amp; (n != 0)) {&quot; +
                            &quot;result = rek(n-1, k-1)+rek(n-1, k);&quot; +
                    '}' +
                    &quot;return result;&quot; +
                    '}' +
                    &quot;main(){&quot; +
                            &quot;int n=4;int k=2;&quot; +
                            &quot;int f = rek(n,k);&quot; +
                    &quot;} ensure f==5;&quot;);
<span class="fc" id="L355">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L356">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L357">	}</span>

    @Test
    public void testArraysFail() {
<span class="fc" id="L361">        executionHandler.parse(&quot;main() {&quot; +</span>
                    &quot;int n = 5; int k = 3; int r = 9;&quot; +
                    &quot;int[][] table = array[n+1][k+1];&quot; +
                    &quot;int i=0; while (i&lt;=n) {&quot; +
                        &quot;int j=0; while ((j&lt;=i) &amp; (j &lt;= k)) {&quot; +
                            &quot;if ((i == j) | (i == 0) | (j == 0)) {&quot; +
                            &quot;table[i][j] = 1;} else {&quot; +
                            &quot;assert (i-1&gt;=0)&amp;(j-1&gt;=0)&amp;(j&lt;=k);&quot; +
                    &quot;table[i][j] = table[i-1][j-1]+table[i-1][j];}&quot; +
                            &quot;j=j+1;&quot; +
                        &quot;}i=i+1;&quot; +
                    &quot;}} ensure table[n][k] == r;&quot;);
<span class="fc" id="L373">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L374">        assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L375">    }</span>

    @Test
    public void testMethodAssumeFail() {
<span class="fc" id="L379">        executionHandler.parse(&quot;int f(int i) assume i&gt;0;{return 0;}&quot; +</span>
                &quot;main() {int x = f(-2);} ensure x &gt; 0;&quot;);
<span class="fc" id="L381">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L382">        assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L383">    }</span>
    
    @Test
    public void testArrayParameterFail() {
<span class="fc" id="L387">        executionHandler.parse(&quot;int f(int[] i) assume length(i) &gt; 3;{return 0;}&quot; +</span>
                &quot;main() {int[] x = array[3]; x[1] = f(x);} ensure x[1] &gt; 0;&quot;);
<span class="fc" id="L389">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L390">        assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L391">    }</span>

    @Test
    public void testArraySumFail() {
<span class="fc" id="L395">        executionHandler.parse(&quot;int sum(int[] i){int j = 0;int res = 0;&quot; +</span>
                &quot;while(j&lt;length(i)){res = res+i[j]; j=j+1;} return res;}&quot; +
                &quot;main() {int[] x = array[3]; x[0]=2;x[1]=-1;x[2]=2;&quot; +
                &quot;int h = sum(x);} ensure h &lt; 0;&quot;);
<span class="fc" id="L399">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L400">        assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L401">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.5.6.201201232323</span>Coverage (04.03.2012 23:49:19)</div></body></html>