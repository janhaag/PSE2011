<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>ExecutionHandlerTest.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Merged (26.02.2012 19:54:06)</a> &gt; <a href="../../index.html" class="el_group">pse</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.html" class="el_package">test</a> &gt; <span class="el_source">ExecutionHandlerTest.java</span></div><h1>ExecutionHandlerTest.java</h1><pre class="source lang-java linenums">package test;

import interpreter.GlobalBreakpoint;
import interpreter.StatementBreakpoint;
import misc.ExecutionHandler;
import misc.MessageSystem;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;

import java.util.ArrayList;

import static org.junit.Assert.*;
/**
 *
 */
<span class="fc" id="L17">public class ExecutionHandlerTest {</span>
    private MessageSystem messageSystem;
    private ExecutionHandler executionHandler;
<span class="fc" id="L20">    private final ArrayList&lt;StatementBreakpoint&gt; stmtBps =</span>
<span class="fc" id="L21">            new ArrayList&lt;StatementBreakpoint&gt;();</span>
<span class="fc" id="L22">    private final ArrayList&lt;GlobalBreakpoint&gt; glblBps =</span>
<span class="fc" id="L23">            new ArrayList&lt;GlobalBreakpoint&gt;();</span>

    @Before
    public void setUp() {
<span class="fc" id="L27">        messageSystem = new MessageSystem();</span>
<span class="fc" id="L28">        executionHandler = new ExecutionHandler(messageSystem);</span>
<span class="fc" id="L29">    }</span>

    @After
    public void tearDown() {
<span class="fc" id="L33">        messageSystem = null;</span>
<span class="fc" id="L34">        executionHandler = null;</span>
<span class="fc" id="L35">    }</span>

    @Test
    public void testLoop() {
<span class="fc" id="L39">        executionHandler.parse(&quot;main() {int i; int limit=1000; while (i&lt;limit)&quot; +</span>
                &quot;invariant i&gt;= 0;{i=i+1;}ensure i&gt;= 0;}&quot; +
        		&quot;ensure i == limit;&quot;);
<span class="fc" id="L42">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L43">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L44">    }</span>

    @Test
    public void testDivision() {
<span class="fc" id="L48">        executionHandler.parse(&quot;main() {assert 4/2==2; assert 5/3==1;&quot; +</span>
                &quot;assert (-4)/2==-2; assert (-5)/3==-2;&quot; +
                &quot;assert 4/(-2)==-2; assert 5/(-3)==-1;&quot; +
                &quot;assert (-4)/(-2)==2; assert (-5)/(-3)==2;}&quot;);
<span class="fc" id="L52">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L53">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L54">    }</span>

    @Test
    public void testModulo() {
<span class="fc" id="L58">        executionHandler.parse(&quot;main() {assert 4%2==0; assert 5%3==2;&quot; +</span>
                &quot;assert (-4)%2==0; assert (-5)%3==1;&quot; +
                &quot;assert 4%(-2)==0; assert 5%(-3)==2;&quot; +
                &quot;assert (-4)%(-2)==0; assert (-5)%(-3)==1;}&quot;);
<span class="fc" id="L62">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L63">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L64">    }</span>

    @Test
    public void testIf() {
<span class="fc" id="L68">        executionHandler.parse(&quot;main() {int i; if (i&lt;2)&quot; +</span>
                &quot;{int i = -1;}}&quot; +
                &quot;ensure i == 00000;&quot;);
<span class="fc" id="L71">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L72">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L73">    }</span>

    @Test
    public void testIfElse() {
<span class="fc" id="L77">        executionHandler.parse(&quot;main() {int i; if (i&gt;2) {int i = -1;}&quot; +</span>
                &quot;else {i=2;}}&quot; +
                &quot;ensure i == 000002;&quot;);
<span class="fc" id="L80">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L81">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L82">    }</span>

    @Test
    public void testParams() {
<span class="fc" id="L86">        executionHandler.parse(&quot;main(int i, int[][] r)&quot; +</span>
                &quot;{int j = 0; while (j &lt; length(r)){i=i+r[j][0]; j=j+1;}}&quot; +
                &quot;ensure i == 42;&quot;);
<span class="fc" id="L89">        executionHandler.setParameterValues(</span>
<span class="fc" id="L90">                new String[]{&quot;2&quot;, &quot;{{20},{11},{9}}&quot;});</span>
<span class="fc" id="L91">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L92">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L93">    }</span>

    @Test
    public void testArraySum() {
<span class="fc" id="L97">        executionHandler.parse(&quot;int sum(int[] i){int j = 0;int res = 0;&quot; +</span>
                &quot;while(j&lt;length(i)){res = res+i[j]; j=j+1;} return res;}&quot; +
                &quot;main() {int[] x = array[3]; x[0]=2;x[1]=-1;x[2]=2;&quot; +
                &quot;int h = sum(x);} ensure h == 3;&quot;);
<span class="fc" id="L101">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L102">        assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L103">    }</span>
    
    @Test
    public void testEmptyProgramEnsureTrue() {
<span class="fc" id="L107">        executionHandler.parse(&quot;main(){} ensure true;&quot;);</span>
<span class="fc" id="L108">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L109">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L110">	}</span>

    @Test
    public void testAssignmentAndEnsure() {
<span class="fc" id="L114">        executionHandler.parse(&quot;main() {int x = 1;} ensure x &gt; 0;&quot;);</span>
<span class="fc" id="L115">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L116">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L117">	}</span>

    @Test
    public void testQuantifiers() {
<span class="fc" id="L121">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4;}&quot; +
                &quot;ensure forall x(2,j) exists z(1,2) (j==x+z) | (j==x*z);&quot;);
<span class="fc" id="L124">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L125">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L126">    }</span>

    @Test
    public void testRecursion() {
<span class="fc" id="L130">        executionHandler.parse(&quot;int rek(int n, int k) assume {n &gt;= k; k &gt;= 0;} {&quot; +</span>
                    &quot;int result = 1;&quot; +
                    &quot;if ((n != k) &amp; (k != 0) &amp; (n != 0)) {&quot; +
                            &quot;result = rek(n-1, k-1)+rek(n-1, k);&quot; +
                    '}' +
                    &quot;return result;&quot; +
                    '}' +
                    &quot;main(){&quot; +
                            &quot;int n=4;int k=2;&quot; +
                            &quot;int f = rek(n,k);&quot; +
                    &quot;} ensure f==6;&quot;);
<span class="fc" id="L141">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L142">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L143">    }</span>

    @Test
    public void testArrays() {
<span class="fc" id="L147">        executionHandler.parse(&quot;main() {&quot; +</span>
                    &quot;int n = 5; int k = 3; int r = 10;&quot; +
                    &quot;int[][] table = array[n+1][k+1];&quot; +
                    &quot;int i=0; while (i&lt;=n) {&quot; +
                        &quot;int j=0; while ((j&lt;=i) &amp; (j &lt;= k)) {&quot; +
                            &quot;if ((i == j) | (i == 0) | (j == 0)) {&quot; +
                            &quot;table[i][j] = 1;} else {&quot; +
                            &quot;assert (i-1&gt;=0)&amp;(j-1&gt;=0)&amp;(j&lt;=k);&quot; +
                    &quot;table[i][j] = table[i-1][j-1]+table[i-1][j];}&quot; +
                            &quot;j=j+1;&quot; +
                        &quot;}i=i+1;&quot; +
                    &quot;}} ensure table[n][k] == r;&quot;);
<span class="fc" id="L159">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L160">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L161">    }</span>

    @Test
    public void testEmptyProgram() {
<span class="fc" id="L165">        executionHandler.parse(&quot;main(){}&quot;);</span>
<span class="fc" id="L166">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L167">		assertNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L168">	}</span>

    @Test
    public void testQuantifierFail() {
<span class="fc" id="L172">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4;}&quot; +
                &quot;ensure forall x(2,j) exists z(1,2) (j==x*z);&quot;);
<span class="fc" id="L175">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L176">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L177">	}</span>

    @Test
    public void testDivZero() {
<span class="fc" id="L181">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4; j = j/(j-4);}&quot;);
<span class="fc" id="L183">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L184">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L185">	}</span>

    @Test
    public void testArrayLength() {
<span class="fc" id="L189">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int[][][] j = array[2][0][3];}&quot;);
<span class="fc" id="L191">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L192">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L193">	}</span>

    @Test
    public void testArrayIndexRead() {
<span class="fc" id="L197">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int[][][] j = array[2][1][3]; int i = j[2][0][1];}&quot;);
<span class="fc" id="L199">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L200">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L201">	}</span>

    @Test
    public void testArrayIndexAssign() {
<span class="fc" id="L205">        executionHandler.parse(&quot;main()&quot; +</span>
        		&quot;{int[][][] j = array[2][1][3]; j[1][-1][1] = 2;}&quot;);
<span class="fc" id="L207">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L208">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L209">	}</span>

    @Test
    public void testModuloZero() {
<span class="fc" id="L213">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 2%0;}&quot;);
<span class="fc" id="L215">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L216">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L217">	}</span>

    @Test
    public void testExistsFail() {
<span class="fc" id="L221">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4;}&quot; +
                &quot;ensure exists z(1,2) (j==3*z);&quot;);
<span class="fc" id="L224">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L225">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L226">	}</span>

    @Test
    public void testForAllFail() {
<span class="fc" id="L230">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4;}&quot; +
                &quot;ensure forall x() (j==x*2);&quot;);
<span class="fc" id="L233">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L234">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L235">	}</span>

    @Test
    public void testEmptySetExistsFail() {
<span class="fc" id="L239">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4;}&quot; +
                &quot;ensure exists z(j,2) true;&quot;);
<span class="fc" id="L242">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L243">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L244">	}</span>

    @Test
    public void testInvariantFailMiddle() {
<span class="fc" id="L248">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4; while (j &lt; 20) invariant j != 15; {j=j+1;}}&quot;);
<span class="fc" id="L250">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L251">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L252">	}</span>

    @Test
    public void testInvariantFailBeginning() {
<span class="fc" id="L256">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4; while (j &lt; 20) invariant j &gt; 4; {j=j+1;}}&quot;);
<span class="fc" id="L258">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L259">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L260">	}</span>

    @Test
    public void testInvariantFailEnd() {
<span class="fc" id="L264">        executionHandler.parse(&quot;main()&quot; +</span>
                &quot;{int j = 4; while (j &lt; 20) invariant j &lt; 20; {j=j+1;}}&quot;);
<span class="fc" id="L266">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L267">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L268">	}</span>

    @Test
    public void testEmptyProgramEnsureFalse() {
<span class="fc" id="L272">        executionHandler.parse(&quot;main(){} ensure false;&quot;);</span>
<span class="fc" id="L273">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L274">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L275">	}</span>

    @Test
    public void testAssumeFalse() {
<span class="fc" id="L279">        executionHandler.parse(&quot;main() assume false;{}&quot;);</span>
<span class="fc" id="L280">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L281">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L282">	}</span>

    @Test
    public void testRecursionFail() {
<span class="fc" id="L286">        executionHandler.parse(&quot;int rek(int n, int k) assume {n &gt;= k; k &gt;= 0;} {&quot; +</span>
                    &quot;int result = 1;&quot; +
                    &quot;if ((n != k) &amp; (k != 0) &amp; (n != 0)) {&quot; +
                            &quot;result = rek(n-1, k-1)+rek(n-1, k);&quot; +
                    '}' +
                    &quot;return result;&quot; +
                    '}' +
                    &quot;main(){&quot; +
                            &quot;int n=4;int k=2;&quot; +
                            &quot;int f = rek(n,k);&quot; +
                    &quot;} ensure f==5;&quot;);
<span class="fc" id="L297">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L298">		assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L299">	}</span>

    @Test
    public void testArraysFail() {
<span class="fc" id="L303">        executionHandler.parse(&quot;main() {&quot; +</span>
                    &quot;int n = 5; int k = 3; int r = 9;&quot; +
                    &quot;int[][] table = array[n+1][k+1];&quot; +
                    &quot;int i=0; while (i&lt;=n) {&quot; +
                        &quot;int j=0; while ((j&lt;=i) &amp; (j &lt;= k)) {&quot; +
                            &quot;if ((i == j) | (i == 0) | (j == 0)) {&quot; +
                            &quot;table[i][j] = 1;} else {&quot; +
                            &quot;assert (i-1&gt;=0)&amp;(j-1&gt;=0)&amp;(j&lt;=k);&quot; +
                    &quot;table[i][j] = table[i-1][j-1]+table[i-1][j];}&quot; +
                            &quot;j=j+1;&quot; +
                        &quot;}i=i+1;&quot; +
                    &quot;}} ensure table[n][k] == r;&quot;);
<span class="fc" id="L315">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L316">        assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L317">    }</span>

    @Test
    public void testMethodAssumeFail() {
<span class="fc" id="L321">        executionHandler.parse(&quot;int f(int i) assume i&gt;0;{return 0;}&quot; +</span>
                &quot;main() {int x = f(-2);} ensure x &gt; 0;&quot;);
<span class="fc" id="L323">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L324">        assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L325">    }</span>
    
    @Test
    public void testArrayParameterFail() {
<span class="fc" id="L329">        executionHandler.parse(&quot;int f(int[] i) assume length(i) &gt; 3;{return 0;}&quot; +</span>
                &quot;main() {int[] x = array[3]; x[1] = f(x);} ensure x[1] &gt; 0;&quot;);
<span class="fc" id="L331">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L332">        assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L333">    }</span>

    @Test
    public void testArraySumFail() {
<span class="fc" id="L337">        executionHandler.parse(&quot;int sum(int[] i){int j = 0;int res = 0;&quot; +</span>
                &quot;while(j&lt;length(i)){res = res+i[j]; j=j+1;} return res;}&quot; +
                &quot;main() {int[] x = array[3]; x[0]=2;x[1]=-1;x[2]=2;&quot; +
                &quot;int h = sum(x);} ensure h &lt; 0;&quot;);
<span class="fc" id="L341">        executionHandler.run(stmtBps, glblBps);</span>
<span class="fc" id="L342">        assertNotNull(executionHandler.getAssertionFailureMessage());</span>
<span class="fc" id="L343">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.5.6.201201232323</span>Merged (26.02.2012 19:54:06)</div></body></html>