<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>MainController.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Merged (29.02.2012 22:39:07)</a> &gt; <a href="../../index.html" class="el_group">pse</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.html" class="el_package">gui.controller</a> &gt; <span class="el_source">MainController.java</span></div><h1>MainController.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">package gui.controller;</span>

import gui.AboutFrame;
import gui.Console;
import gui.FileFrame;
import gui.HelpFrame;
import gui.MainFrame;
import gui.ParameterFrame;
import gui.RandomTestFrame;
import gui.SettingsFrame;

import interpreter.StatementBreakpoint;

import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;

import misc.Editor;
import misc.ExecutionHandler;
import misc.Help;
import misc.Message;
import misc.MessageSystem;
import misc.Settings;

import org.eclipse.swt.SWT;
import org.eclipse.swt.dnd.TextTransfer;
import org.eclipse.swt.dnd.Transfer;
import org.eclipse.swt.events.SelectionEvent;
import org.eclipse.swt.events.SelectionListener;
import org.eclipse.swt.graphics.Image;
import org.eclipse.swt.graphics.Point;

/**
 * This class is the most important part of the GUI component. It initializes
 * all of the other controllers and delegates user actions to their respective
 * receiver controllers. It is also responsible for the view @see{MainFrame} 
 * and uses @see{ExecutionHandler} as model.
 */
<span class="pc bpc" id="L44" title="1 of 2 branches missed.">public class MainController implements SelectionListener {</span>
	/**
	 * model and connection with other components
	 */
	private ExecutionHandler executionHandler;
	/**
	 * main view for displaying all other views
	 */
	private MainFrame mainframe;
	/**
	 * controller for settings
	 */
	private SettingsController settingsController;
	/**
	 * controller for help
	 */
	private HelpController helpController;
	/**
	 * controller for parameter input
	 */
	private ParameterController parameterContoller;
	/**
	 * controller for editor
	 */
	private EditorController editorController;
	/**
	 * controller for variables and breakpoints
	 */
	private TableViewController tableController;

	/**
	 * Construct a main controller and initializes all other controllers.
	 */
<span class="nc" id="L77">	public MainController() {</span>
<span class="nc" id="L78">		MessageSystem messagesystem = new MessageSystem();</span>
<span class="nc" id="L79">		this.executionHandler = new ExecutionHandler(messagesystem);</span>
<span class="nc" id="L80">		Editor editor = new Editor();</span>
<span class="nc" id="L81">		this.mainframe = new MainFrame(this, editor, messagesystem);</span>
<span class="nc" id="L82">		this.editorController = new EditorController(editor, this.mainframe.getEditor());</span>
<span class="nc" id="L83">		this.settingsController = new SettingsController(Settings.getInstance());</span>
<span class="nc" id="L84">		this.helpController = new HelpController(Help.getInstance(), this.mainframe.getHelpBox());</span>
<span class="nc" id="L85">		this.parameterContoller = new ParameterController(this.executionHandler, messagesystem);</span>
<span class="nc" id="L86">		this.tableController = new TableViewController(this.mainframe.getBreakpointView(), </span>
<span class="nc" id="L87">				this.mainframe.getVarView(), this.executionHandler);</span>

		// Has to be the last call in the constructor
<span class="nc" id="L90">		initMainFrame();</span>
<span class="nc" id="L91">	}</span>

	/**
	 * Open the main frame.
	 */
	private void initMainFrame() {
		/*
		 * Very important to call this in a separated method because SWT uses an
		 * infinite loop for its window management and we need the instance of
		 * MainFrame.
		 */
<span class="nc" id="L102">		this.mainframe.openWindow();</span>
<span class="nc" id="L103">	}</span>

	@Override
	public void widgetSelected(SelectionEvent e) {
		//menu bar button events
<span class="fc bfc" id="L108" title="All 2 branches covered.">		if (e.getSource() == this.mainframe.getMenuBar().getMenuBarItemExit()) {</span>
			//Save modified settings
<span class="fc bfc" id="L110" title="All 2 branches covered.">			if(Settings.getInstance().settingsChanged()) {</span>
				try {
<span class="fc" id="L112">					Settings.getInstance().saveSettings();</span>
<span class="nc" id="L113">				} catch (IOException ioe) {</span>
					//The default settings will be loaded at the next program start
				}
			}
<span class="nc" id="L117">			System.exit(0);</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">		} else if (e.getSource() == mainframe.getMenuBar().getMenuBarItemLoad()) {</span>
<span class="fc" id="L119">			FileFrame openFileFrame = new FileFrame(this.mainframe.getShell(), SWT.OPEN);</span>
<span class="pc bpc" id="L120" title="1 of 2 branches missed.">			if (openFileFrame.getChosenFile() != null) {</span>
<span class="fc" id="L121">				String fileText = getFileAsString(openFileFrame.getChosenFile());</span>
<span class="pc bpc" id="L122" title="1 of 2 branches missed.">				if (fileText != null) {</span>
<span class="fc" id="L123">					this.editorController.getEditor().setSource(fileText);</span>

					//clear consoles
<span class="fc bfc" id="L126" title="All 2 branches covered.">					for(Console console : this.mainframe.getConsole()) {</span>
<span class="fc" id="L127">						console.updateConsole(new ArrayList&lt;Message&gt;());</span>
					}
					
					//delete breakpoints
					//save all lines first, otherwise there will be an exception because of concurrent modification
<span class="fc" id="L132">					ArrayList&lt;StatementBreakpoint&gt; breakpoints = this.editorController.getEditor().getStatementBreakpoints();</span>
<span class="fc" id="L133">					int[] lines = new int[breakpoints.size()];</span>
<span class="pc bpc" id="L134" title="1 of 2 branches missed.">					for(int i = 0; i &lt; breakpoints.size(); i++) {</span>
<span class="nc" id="L135">						lines[i] = breakpoints.get(i).getLine();</span>
					}
<span class="pc bpc" id="L137" title="1 of 2 branches missed.">					for(int i = 0; i &lt; lines.length; i++) {</span>
<span class="nc" id="L138">						this.editorController.getEditor().removeBreakpoint(lines[i]);</span>
<span class="nc" id="L139">						this.mainframe.getEditor().setStatementBreakpoint(lines[i], 0);</span>
					}
					
					//stop execution
<span class="pc bpc" id="L143" title="1 of 2 branches missed.">					if (this.executionHandler.getProgramExecution() != null) {</span>
<span class="nc" id="L144">						this.stopView();</span>
					}
				}
			}
<span class="fc bfc" id="L148" title="All 2 branches covered.">		} else if (e.getSource() == mainframe.getMenuBar().getMenuBarItemSave()) {</span>
<span class="fc" id="L149">			FileFrame saveFileFrame = new FileFrame(this.mainframe.getShell(), SWT.SAVE);</span>
<span class="pc bpc" id="L150" title="1 of 2 branches missed.">			if (saveFileFrame.getChosenFile() != null) {</span>
<span class="fc" id="L151">				writeStringToFile(this.editorController.getEditor().getSource(), saveFileFrame.getChosenFile());</span>
			}
<span class="fc bfc" id="L153" title="All 2 branches covered.">		} else if (e.getSource() == mainframe.getMenuBar().getMenuBarItemNewFile()) {</span>
<span class="fc" id="L154">			this.editorController.getEditor().setSource(&quot;&quot;);</span>
			//clear consoles
<span class="fc bfc" id="L156" title="All 2 branches covered.">			for(Console console : this.mainframe.getConsole()) {</span>
<span class="fc" id="L157">				console.updateConsole(new ArrayList&lt;Message&gt;());</span>
			}
			
			//delete breakpoints
			//save all lines first, otherwise there will be an exception because of concurrent modification
<span class="fc" id="L162">			ArrayList&lt;StatementBreakpoint&gt; breakpoints = this.editorController.getEditor().getStatementBreakpoints();</span>
<span class="fc" id="L163">			int[] lines = new int[breakpoints.size()];</span>
<span class="pc bpc" id="L164" title="1 of 2 branches missed.">			for(int i = 0; i &lt; breakpoints.size(); i++) {</span>
<span class="nc" id="L165">				lines[i] = breakpoints.get(i).getLine();</span>
			}
<span class="pc bpc" id="L167" title="1 of 2 branches missed.">			for(int i = 0; i &lt; lines.length; i++) {</span>
<span class="nc" id="L168">				this.editorController.getEditor().addBreakpoint(lines[i]);</span>
<span class="nc" id="L169">				this.mainframe.getEditor().setStatementBreakpoint(lines[i], 0);</span>
			}
			
			//stop execution
<span class="pc bpc" id="L173" title="1 of 2 branches missed.">			if (this.executionHandler.getProgramExecution() != null) {</span>
<span class="nc" id="L174">				this.stopView();</span>
			}
<span class="fc bfc" id="L176" title="All 2 branches covered.">		} else if (e.getSource() == mainframe.getMenuBar().getMenuBarItemSettings()) {</span>
<span class="fc" id="L177">			new SettingsFrame(this.mainframe.getShell(), this.settingsController);</span>
<span class="fc bfc" id="L178" title="All 2 branches covered.">		} else if (e.getSource() == mainframe.getMenuBar().getMenuBarItemRandomTest()) {</span>
<span class="fc" id="L179">			RandomTestFrame randomtestframe = new RandomTestFrame(this.mainframe.getShell());</span>
<span class="fc" id="L180">			this.parameterContoller.addRandomTestFrame(randomtestframe, this.editorController.getEditor().getSource());</span>
<span class="fc bfc" id="L181" title="All 2 branches covered.">		} else if (e.getSource() == mainframe.getMenuBar().getMenurBarItemAbout()) {</span>
<span class="fc" id="L182">			new AboutFrame(this.mainframe.getShell());</span>
<span class="fc bfc" id="L183" title="All 2 branches covered.">		} else if (e.getSource() == mainframe.getMenuBar().getMenuBarItemHelp()) {</span>
<span class="fc" id="L184">			new HelpFrame(this.mainframe.getShell(), this.helpController);</span>
<span class="fc bfc" id="L185" title="All 2 branches covered.">		} else if (e.getSource() == mainframe.getMenuBar().getMenurBarItemUndo()) {</span>
<span class="fc" id="L186">			this.editorController.getEditor().undo();</span>
<span class="fc bfc" id="L187" title="All 2 branches covered.">		} else if (e.getSource() == mainframe.getMenuBar().getMenuBarItemRedo()) {</span>
<span class="fc" id="L188">			this.editorController.getEditor().redo();</span>
<span class="fc bfc" id="L189" title="All 2 branches covered.">		} else if (e.getSource() == mainframe.getMenuBar().getMenuBarItemCut()) {</span>
<span class="fc" id="L190">			Point selection = this.mainframe.getEditor().getSelection();</span>
<span class="fc" id="L191">			String source = this.mainframe.getEditor().getText();</span>
<span class="fc" id="L192">			String cutSource = source.substring(0, selection.x) + source.substring(selection.y);</span>
<span class="fc" id="L193">			this.editorController.getEditor().setSource(cutSource);</span>
<span class="fc" id="L194">			this.mainframe.getEditor().getTextField().setSelection(selection.x);</span>
			
<span class="fc" id="L196">			String cut = source.substring(selection.x, selection.y);</span>
<span class="pc bpc" id="L197" title="2 of 4 branches missed.">			if(cut != null &amp;&amp; cut != &quot;&quot;) {</span>
<span class="fc" id="L198">				this.mainframe.getClipboard().setContents(new Object[]{cut}, new Transfer[]{TextTransfer.getInstance()});</span>
			}
<span class="fc bfc" id="L200" title="All 2 branches covered.">		} else if (e.getSource() == mainframe.getMenuBar().getMenuBarItemCopy()) {</span>
<span class="fc" id="L201">			Point selection = this.mainframe.getEditor().getSelection();</span>
<span class="fc" id="L202">			String source = this.mainframe.getEditor().getText();</span>
<span class="fc" id="L203">			String copy = source.substring(selection.x, selection.y);</span>
<span class="pc bpc" id="L204" title="2 of 4 branches missed.">			if(copy != null &amp;&amp; copy != &quot;&quot;) {</span>
<span class="fc" id="L205">				this.mainframe.getClipboard().setContents(new Object[]{copy}, new Transfer[]{TextTransfer.getInstance()});</span>
			}
<span class="pc bpc" id="L207" title="1 of 2 branches missed.">		} else if (e.getSource() == mainframe.getMenuBar().getMenuBarItemPaste()) {</span>
<span class="fc" id="L208">			String paste = (String) this.mainframe.getClipboard().getContents(TextTransfer.getInstance());</span>
<span class="pc bpc" id="L209" title="2 of 4 branches missed.">			if(paste != null &amp;&amp; !paste.equals(&quot;&quot;)) {</span>
<span class="fc" id="L210">				Point selection = this.mainframe.getEditor().getSelection();</span>
<span class="fc" id="L211">				String source = this.mainframe.getEditor().getText();</span>
<span class="fc" id="L212">				String pastedSource = source.substring(0, selection.x) + paste + source.substring(selection.y); </span>
<span class="fc" id="L213">				this.editorController.getEditor().setSource(pastedSource);</span>
<span class="fc" id="L214">				this.mainframe.getEditor().getTextField().setSelection(selection.x + paste.length());</span>
			}
			//String pastedSource = source.substring(0, selection.x) + 
		}
		//button events
<span class="nc bnc" id="L219" title="All 2 branches missed.">		else if (e.getSource() == this.mainframe.getRunButton() </span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">				|| e.getSource() == this.mainframe.getMenuBar().getMenuBarItemRun()) {</span>
<span class="nc bnc" id="L221" title="All 4 branches missed.">			assert editorController != null;</span>
<span class="nc" id="L222">			this.executionHandler.setPaused(false);</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">			if (this.executionHandler.getAST() == null) {</span>
<span class="nc" id="L224">				this.tableController.getVarView().getVarTree().removeAll();</span>
<span class="nc" id="L225">				this.executionHandler.parse(this.editorController.getEditor().getSource());</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">				if (this.executionHandler.getAST() != null) {</span>
<span class="nc" id="L227">					ParameterFrame parameterframe = new ParameterFrame(this.mainframe.getShell());</span>
<span class="nc" id="L228">					parameterContoller.addParameterFrame(parameterframe);</span>
				} else {
<span class="nc" id="L230">					return;</span>
				}
			}			
<span class="nc" id="L233">			this.runView();</span>
			
			//Execution
<span class="nc" id="L236">			new Thread() {</span>
				public void run() {
<span class="nc bnc" id="L238" title="All 2 branches missed.">					while (!parameterContoller.getParameterframe().getShell().isDisposed()</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">							&amp;&amp; !(executionHandler.getAST().getMainFunction().getParameters() == null</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">							|| executionHandler.getAST().getMainFunction().getParameters().length == 0)) {</span>
						try {
<span class="nc" id="L242">							sleep(100);</span>
<span class="nc" id="L243">						} catch (InterruptedException ignored) {</span>
						}
					}
<span class="nc" id="L246">					executionHandler.run(editorController.getEditor().getStatementBreakpoints(),</span>
<span class="nc" id="L247">							executionHandler.getGlobalBreakpoints());</span>
<span class="nc" id="L248">					mainframe.getDisplay().asyncExec(new Runnable() {</span>
						public void run() {
<span class="nc bnc" id="L250" title="All 2 branches missed.">							if (executionHandler.getAssertionFailureMessage() != null) {</span>
<span class="nc" id="L251">								executionHandler.printAssertionFailureMessage();</span>
<span class="nc" id="L252">								stopView();</span>
<span class="nc" id="L253">								return;</span>
							}
<span class="nc bnc" id="L255" title="All 2 branches missed.">							if (executionHandler.getPaused()) {</span>
<span class="nc" id="L256">								pauseView();</span>
							}
							else {
<span class="nc bnc" id="L259" title="All 2 branches missed.">								if (executionHandler.getProgramExecution() != null </span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">										&amp;&amp; executionHandler.getProgramExecution().getCurrentState().getCurrentStatement() == null) {</span>
<span class="nc" id="L261">									executionHandler.addSuccessMessage(&quot;Program execution successful!&quot;);</span>
								}
								else {
<span class="nc" id="L264">									executionHandler.addSuccessMessage(&quot;stopped execution&quot;);</span>
								}
<span class="nc" id="L266">								stopView();</span>
							}
<span class="nc" id="L268">						}</span>
					});
<span class="nc" id="L270">				}</span>
<span class="nc" id="L271">			}.start();</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">		} else if (e.getSource() == this.mainframe.getStepButton() </span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">				|| e.getSource() == this.mainframe.getMenuBar().getMenuBarItemStep()) {</span>
			//Functions
<span class="nc bnc" id="L275" title="All 4 branches missed.">			assert editorController != null;</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">			if (this.executionHandler.getAST() == null) {</span>
<span class="nc" id="L277">				this.tableController.getVarView().getVarTree().removeAll();</span>
<span class="nc" id="L278">				this.executionHandler.parse(this.editorController.getEditor().getSource());</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">				if (this.executionHandler.getAST() != null) {</span>
<span class="nc" id="L280">					ParameterFrame parameterframe = new ParameterFrame(this.mainframe.getShell());</span>
<span class="nc" id="L281">					this.parameterContoller.addParameterFrame(parameterframe);</span>
				} else {
<span class="nc" id="L283">					return;</span>
				}
			}
			
			//Execution
<span class="nc" id="L288">			new Thread() {</span>
				public void run() {
<span class="nc bnc" id="L290" title="All 2 branches missed.">					while (!parameterContoller.getParameterframe().getShell().isDisposed()</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">							&amp;&amp; !(executionHandler.getAST().getMainFunction().getParameters() == null</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">							|| executionHandler.getAST().getMainFunction().getParameters().length == 0)) {</span>
						try {
<span class="nc" id="L294">							sleep(100);</span>
<span class="nc" id="L295">						} catch (InterruptedException ignored) {</span>
						}
					}
<span class="nc" id="L298">					executionHandler.singleStep(editorController.getEditor().getStatementBreakpoints(),</span>
<span class="nc" id="L299">							executionHandler.getGlobalBreakpoints());</span>
<span class="nc" id="L300">					mainframe.getDisplay().asyncExec(new Runnable() {</span>
						public void run() {
<span class="nc" id="L302">							pauseView();</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">							if (executionHandler.getAssertionFailureMessage() != null) {</span>
<span class="nc" id="L304">								executionHandler.printAssertionFailureMessage();</span>
<span class="nc" id="L305">								stopView();</span>
<span class="nc" id="L306">								return;</span>
							}
<span class="nc" id="L308">							tableController.updateVarView();</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">							if (executionHandler.getProgramExecution() != null</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">									&amp;&amp; executionHandler.getProgramExecution().getCurrentState().getCurrentStatement() == null) {</span>
<span class="nc" id="L311">								stopView();</span>
<span class="nc" id="L312">								executionHandler.addSuccessMessage(&quot;Program execution successful!&quot;);</span>
							}
<span class="nc" id="L314">						}</span>
					});
<span class="nc" id="L316">				}</span>
<span class="nc" id="L317">			}.start();</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">		} else if (e.getSource() == mainframe.getPauseButton()) {</span>
<span class="nc" id="L319">			this.executionHandler.setPaused(true);</span>
<span class="nc bnc" id="L320" title="All 2 branches missed.">		} else if (e.getSource() == mainframe.getStopButton()) {</span>
<span class="nc" id="L321">			this.stopView();</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">		} else if (e.getSource() == mainframe.getCheckSyntaxButton()) {</span>
			//Functions
<span class="nc bnc" id="L324" title="All 4 branches missed.">			assert editorController != null;</span>
<span class="nc" id="L325">			this.executionHandler.parse(this.editorController.getEditor().getSource());</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">			if (this.executionHandler.getAST() != null) {</span>
<span class="nc" id="L327">				this.executionHandler.addSuccessMessage(&quot;Syntax is correct!&quot;);</span>
			}
<span class="nc" id="L329">			this.executionHandler.setAST(null);</span>
<span class="nc bnc" id="L330" title="All 4 branches missed.">		} else if (e.getSource() == mainframe.getValidateButton() || e.getSource() == mainframe.getMenuBar().getVerItem()) {</span>
<span class="nc" id="L331">            this.executionHandler.verify(this.editorController.getEditor().getSource());</span>
<span class="nc" id="L332">			this.executionHandler.setAST(null);</span>
		}
<span class="fc" id="L334">	}</span>

	/**
	 * Update the main frame when changed to running state.
	 */
	private void runView() {
		//Functions
<span class="nc" id="L341">		this.editorController.removeMark();</span>
		//Images
<span class="nc" id="L343">		Image image = new Image(this.mainframe.getDisplay(), </span>
<span class="nc" id="L344">				MainFrame.class.getResourceAsStream(&quot;image/run2.png&quot;));</span>
<span class="nc" id="L345">		Image image2 = new Image(this.mainframe.getDisplay(),</span>
<span class="nc" id="L346">				MainFrame.class.getResourceAsStream(&quot;image/pause1.png&quot;));</span>
<span class="nc" id="L347">		this.mainframe.switchIcon(image, image2);</span>
		//(De-)activations
<span class="nc" id="L349">		this.mainframe.getPauseButton().setEnabled(true);</span>
<span class="nc" id="L350">		this.mainframe.getStepButton().setEnabled(false);</span>
<span class="nc" id="L351">		this.mainframe.getStopButton().setEnabled(true);</span>
<span class="nc" id="L352">		this.mainframe.getCheckSyntaxButton().setEnabled(false);</span>
<span class="nc" id="L353">		this.tableController.activateVarView();</span>
<span class="nc" id="L354">		this.tableController.deactivateBreakpointView();</span>
<span class="nc" id="L355">		this.tableController.getVarView().getVarTree().removeAll();</span>
<span class="nc" id="L356">		this.editorController.deactivateView();</span>
<span class="nc" id="L357">	}</span>
	
	/**
	 * Update the main frame when changed to paused state.
	 */
	private void pauseView() {
		//Functions
<span class="nc" id="L364">		this.tableController.updateVarView();</span>
<span class="nc" id="L365">		this.editorController.removeMark();</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">		if (this.executionHandler.getProgramExecution() != null</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">				&amp;&amp; this.executionHandler.getProgramExecution().getCurrentState().getCurrentStatement() != null) {</span>
<span class="nc" id="L368">			int line = this.executionHandler.getProgramExecution().getCurrentState().getCurrentStatement().getPosition().getLine();</span>
<span class="nc" id="L369">			this.editorController.markCurrentLine(line - 1);</span>
		}
		//Images
<span class="nc" id="L372">		Image image = new Image(this.mainframe.getDisplay(), </span>
<span class="nc" id="L373">				MainFrame.class.getResourceAsStream(&quot;image/run1.png&quot;));</span>
<span class="nc" id="L374">		Image image2 = new Image(this.mainframe.getDisplay(),</span>
<span class="nc" id="L375">				MainFrame.class.getResourceAsStream(&quot;image/pause2.png&quot;));</span>
		//(De-)activations
<span class="nc" id="L377">		this.mainframe.switchIcon(image, image2);</span>
<span class="nc" id="L378">		this.mainframe.getStepButton().setEnabled(true);</span>
<span class="nc" id="L379">		this.mainframe.getPauseButton().setEnabled(false);</span>
<span class="nc" id="L380">		this.mainframe.getStopButton().setEnabled(true);</span>
<span class="nc" id="L381">		this.mainframe.getCheckSyntaxButton().setEnabled(false);</span>
<span class="nc" id="L382">		this.editorController.deactivateView();</span>
<span class="nc" id="L383">		this.tableController.activateVarView();</span>
<span class="nc" id="L384">		this.tableController.deactivateBreakpointView();</span>
<span class="nc" id="L385">	}</span>
	
	/**
	 * Update the view when changed to idle state.
	 */
	private void stopView() {
		//Functions
<span class="nc" id="L392">		this.editorController.removeMark();</span>
<span class="nc" id="L393">		this.tableController.updateVarView();</span>
<span class="nc" id="L394">		this.executionHandler.destroyProgramExecution();</span>
<span class="nc" id="L395">		this.executionHandler.setParameterValues(null);</span>
<span class="nc" id="L396">		this.executionHandler.setAST(null);</span>
		//Images
<span class="nc" id="L398">		Image image = new Image(this.mainframe.getDisplay(), </span>
<span class="nc" id="L399">				MainFrame.class.getResourceAsStream(&quot;image/run1.png&quot;));</span>
<span class="nc" id="L400">		Image image2 = new Image(this.mainframe.getDisplay(), </span>
<span class="nc" id="L401">				MainFrame.class.getResourceAsStream(&quot;image/pause1.png&quot;));</span>
<span class="nc" id="L402">		this.mainframe.switchIcon(image, image2);</span>
		//(De-)activations
<span class="nc" id="L404">		this.mainframe.getStopButton().setEnabled(false);</span>
<span class="nc" id="L405">		this.mainframe.getPauseButton().setEnabled(false);</span>
<span class="nc" id="L406">		this.mainframe.getStepButton().setEnabled(true);</span>
<span class="nc" id="L407">		this.mainframe.getCheckSyntaxButton().setEnabled(true);</span>
<span class="nc" id="L408">		this.tableController.deactivateVarView();</span>
<span class="nc" id="L409">		this.tableController.activateBreakpointView();</span>
<span class="nc" id="L410">		this.editorController.activateView();</span>
<span class="nc" id="L411">	}</span>

	private static String getFileAsString(File file) {
<span class="fc" id="L414">		BufferedReader fileReader = null;</span>
		try {
<span class="fc" id="L416">			fileReader = new BufferedReader(new FileReader(file));</span>
<span class="nc" id="L417">		} catch (FileNotFoundException e1) {</span>
<span class="nc" id="L418">			e1.printStackTrace();</span>
		}
<span class="fc" id="L420">		String line = null;</span>
<span class="fc" id="L421">		String fileText = new String();</span>
		try {
<span class="fc bfc" id="L423" title="All 2 branches covered.">			while ((line = fileReader.readLine()) != null) {</span>
<span class="fc" id="L424">				fileText += line + '\n';</span>
			}
<span class="nc" id="L426">		} catch (IOException e1) {</span>
<span class="nc" id="L427">			e1.printStackTrace();</span>
		}
<span class="fc" id="L429">		return fileText;</span>
	}

	private static void writeStringToFile(String content, File file) {
<span class="fc" id="L433">		BufferedWriter fileWriter = null;</span>
		try {
<span class="fc" id="L435">			fileWriter = new BufferedWriter(new FileWriter(file));</span>
<span class="fc" id="L436">			fileWriter.write(content);</span>
<span class="fc" id="L437">			fileWriter.close();</span>

<span class="nc" id="L439">		} catch (IOException e) {</span>
<span class="nc" id="L440">			e.printStackTrace();</span>
		}
<span class="fc" id="L442">	}</span>

	@Override
	public void widgetDefaultSelected(SelectionEvent e) {
<span class="nc" id="L446">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.5.6.201201232323</span>Merged (29.02.2012 22:39:07)</div></body></html>